### Atelier 5 (ACT-2003) ###
### Solutions ###

### Continuation du dernier atelier ###
library(CASdatasets)
data("usexpense")

### Mod?le g?n?r? pour amorcer la section "Mod?lisation et inf?rence statistique"
modele <- lm(I(log(1+Expenses))~Group+Mutual+Stock+I(log(1+StaffWage))+I(log(1+AgentWage))
+I(log(1+LongLoss))+I(log(1+ShortLoss))+I(log(1+GWPpersonal))+I(log(1+GWPcommercial))+
I(log(1+Assets))+I(log(1+Cash)),data=usexpense)
### Nouveau mod?le ajust? suite au non-rejet de l'hypoth?se nulle stipulant que le
### coefficient li? ? la variable AgentWage transform?e est nul
modele2 <- update(modele,~.-I(log(1+AgentWage)))

### Mod?lisation et inf?rence statistique (suite) ###
### Question 6 ###
#Les d?penses totales encourues transform?es sont en moyenne inf?rieures de 0.001748
#unit? chez les mutuelles d'assurance comparitivement aux compagnies qui ne sont ni des
#mutuelles ni des soci?t?s par actions, lorsque les autres variables exog?nes demeurent
#inchang?es.

#Les d?penses totales encourues transform?es sont en moyenne inf?rieures de 0.003119
#unit? chez les soci?t?s par actions comparitivement aux compagnies qui ne sont ni des
#mutuelles ni des soci?t?s par actions, lorsque les autres variables exog?nes demeurent
#inchang?es.

#Il est int?ressant de constater que les deux variables indicatrices ne somment jamais
#? deux. Cela s'explique par le fait qu'une compagnie ne peut ?tre ? la fois une 
#mutuelle et une soci?t? par actions. En fait, ces deux variables indicatrices forment
#deux niveaux d'une variable polytomique ? trois niveaux, cette variable ?tant la 
#structure d'entreprise de la compagnie d'assurance, o? la classe de r?f?rence (de base)
#regroupe toutes les compagnies d'assurance qui ne sont ni des mutuelles, ni des 
#soci?t?s par actions.

### Question 7 ###
summary(modele2)
#Le seuil observ? est, dans ce cas-ci, inf?rieur ? 2.2*10^(-16), ce qui est nettement
#plus petit que tout seuil raisonnable pour un test d'hypoth?ses (entre 1 et 10 %). On
#peut donc rejeter l'hypoth?se nulle. Ainsi, il y a au moins une variable exog?ne qui
#contribue ? expliquer de fa?on significative la variabilit? dans la variable endog?ne.

### Question 8 ###
#Il s'agit, dans ce cas-ci, d'un test F partiel. Les hypoth?ses sont donc les suivantes:
#H0: Le mod?le r?duit suffit ? expliquer la variabilit? dans les Y.
#H1: Le mod?le r?duit n'est pas suffisamment ad?quat pour expliquer la variabilit? dans
#les Y, le mod?le r?duit ?tant le mod?le complet d?nud? de la variable Assets
#transform?e.
mod_red <- update(modele2,~.-I(log(1+Assets)))
anova(mod_red,modele2)
#Le seuil observ? est, dans ce cas-ci, de 0.003705, ce qui inf?rieur ? tout seuil
#typiquement choisi pour ce genre de test d'hypoth?ses (entre 1 et 10 %). On peut donc
#rejeter l'hypoth?se nulle. Ce r?sultat demeure toutefois surprenant car nous savons
#qu'il ne serait pas raisonnable de garder simultan?ment les deux variables dans notre
#mod?le, question de multicolin?arit?.

### Question 9 ###
X_mat <- modele2$model[,-1]
cor(X_mat,method="pearson")
#Le coin inf?rieur droit de la matrice des corr?lations entre les variables exog?nes
#nous indique que le coefficient de corr?lation lin?aire de Pearson entre les variables
#Assets et Cash transform?es est de 0.99679634, appuyant la tr?s forte corr?lation
#lin?aire positive, voire presque parfaite, observ?e entre les deux variables dans le
#diagramme en nuage de points.

### Question 10 ###
library(car)
vif(modele2)
#Nous observons des facteurs d'inflation de la variance extr?mement grands uniquement
#pour les deux variables tr?s fortement corr?l?es. Cela vient appuyer les constats
#soulev?s pr?c?demment sur le sujet. Il devient alors int?ressant de les recalculer de
#nouveau pour le mod?le r?duit g?n?r? au num?ro 8, question de voir si l'octroi d'une
#des deux variables r?gle le probl?me de multicolin?arit? au sens large.
vif(mod_red)
#Le vif associ? ? la variable Cash transform?e a diminu? consid?rablement, passant de
#181 ? 4,2. Cela confirme que la multicolin?arit? est presque exclusivement attribuable
#? l'inclusion des deux variables redondantes dans notre mod?le.

### Analyse des r?sidus ###
### Question 1 ###
par(mfrow=c(3,2))
vec_index=c(7,9,10,11,12,14)
for(i in 1:6)
  plot(usexpense[,vec_index[i]],rstudent(mod_red),xlab=names(usexpense)[vec_index[i]],
  main=names(usexpense)[vec_index[i]])
#Dans chaque graphique, on remarque que les r?sidus oscillent al?atoirement autour de
#l'axe y=0. On peut donc conclure que l'hypoth?se de lin?arit? semble raisonnable dans
#ce cas-ci.

### Question 2 ###
par(mfrow=c(1,1))
plot(mod_red$fitted.values,rstudent(mod_red),xlab="Valeurs pr?dites",
     ylab="R?sidus studentis?s")
#On observe dans ce graphique la pr?sence d'un entonnoir ouvert vers la droite. Par
#cons?quent, on peut affirmer que l'hypoth?se d'homosc?dasticit? n'est pas respect?e
#dans ce cas-ci.

### Question 3 ###
qqnorm(rstudent(mod_red))
qqline(as.numeric(rstudent(mod_red)))
#La distribution des r?sidus studentis?s exhibe des queues plus lourdes que la
#distribution normale centr?e r?duite. Par cons?quent, on peut donc affirmer que 
#l'hypoth?se de normalit? n'est pas respect?e dans ce cas-ci.
