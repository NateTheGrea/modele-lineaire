### Atelier 4 (ACT-2003) ###
### Solutions ###

### Importation des donn?es ###

library(CASdatasets)
data("usexpense")

### Analyse univari?e pr?liminaire ###
### Question 1 ###
#La variable endog?ne est, dans ce cas-ci, les d?penses totales encourues (Expenses).

### Question 2 ###
#Il y a, dans ce cas-ci, 9 variables continues d'int?r?t. Les voici: Expenses, StaffWage,
#AgentWage, LongLoss, ShortLoss, GWPpersonal, GWPcommercial, Assets, Cash.
par(mfrow=c(3,3))
for(i in 6:14)
    hist(usexpense[,i],main=names(usexpense)[i],xlab=names(usexpense)[i])

### Question 3 ###
#Toutes les variables non-continues d'int?r?t sont, dans ce cas-ci, des variables
#indicatrices et donc, mesurables selon une ?chelle nominale. Il s'agit de Group, Mutual
#et Stock.
par(mfrow=c(1,3))
for(i in 2:4)
{
  tab_freq=table(usexpense[,i])
  barplot(tab_freq,col=c("red","blue"),main=names(usexpense)[i])
}

### Question 4 ###
summary(usexpense)
#En examinant attentivement le sommaire, on constate que plusieurs variables continues
#(Expenses, LongLoss, ShortLoss, GWPpersonal, GWPcommercial) exhibent des valeurs
#n?gatives. De plus, la variable AgentWage comporte 19 valeurs manquantes.

### Question 5 ###
for(i in 6:14)
{
  print(names(usexpense)[i])
  print(summary(log(1+usexpense[,i])))
}

### Question 6 ###
pairs(log(1+usexpense[,6:14]))
#Le graphique Assets vs Cash exhibe une tr?s forte corr?lation positive. On peut donc
#conclure, visuellement parlant, que les deux variables sont redondantes 
#(probl?me potentiel de multicolin?arit?)

### Question 7 ###
library(ggplot2)
boxplot(log(1+Expenses)~Group,data=usexpense)
#Le diagramme ? moustache indique que la m?diane, la moyenne, le troisi?me quartile et
#le maximum sont plus ?lev?s pour la modalit? 1 que la modalit? 0. On peut d'ailleurs 
#confirmer ces constats visuels avec la fonction R summary. On peut ainsi conclure que
#le niveau de d?penses totales encourues est plus ?lev? au sein des compagnies affili?es.

### Mod?lisation et inf?rence statistique ###
### Question 1  ###
modele <- lm(I(log(1+Expenses)) ~ Group + Mutual + Stock +I(log(1+StaffWage))+
I(log(1+AgentWage))+I(log(1+LongLoss))+I(log(1+ShortLoss))+I(log(1+GWPpersonal))+
I(log(1+GWPcommercial))+I(log(1+Assets))+I(log(1+Cash)),data=usexpense)
summary(modele)
#Une estimation sans biais pour l'?cart-type des termes d'erreur est de 0.02235.
#Le coefficient de d?termination est, dans ce cas-ci, de 0.9422.

### Question 2 ###
#La fonction R lm rejette par d?faut toute observation comprenant des champs manquants.
#Or, nous savons d?j? qu'il y a 19 valeurs manquantes pour la variable AgentWage. La
#fonction a donc ignor? les 19 observations associ?es ? ces valeurs manquantes lors de
#la mod?lisation.

### Question 3 ###
#Le seuil observ? (0.91937) pour ce test est tr?s ?lev?. Nous ne sommes donc pas en
#mesure de rejeter l'hypoth?se nulle stipulant que ledit coefficient est nul pour tout
#seuil typique (entre 1 et 10%). Il est donc appropri? d'ajuster un nouveau mod?le
#sans cette variable.
modele2 <- update(modele,~.-I(log(1+AgentWage)))
#On constate que l'octroi de la variable AgentWage transform?e fait en sorte qu'il n'y a
#plus de donn?es manquantes. Le nouveau mod?le consid?re alors toutes les observations
#de notre jeu de donn?es.

### Question 4 ###
summary(modele2)
#Le coefficient attach? ? cette variable est de 0.089370. Cela signifie que lorsque les
#primes brutes souscrites transform?es pour les lignes commerciales augmentent d'une
#unit?, tout en maintenant les autres variables exog?nes fixes, les d?penses totales
#encourues transform?es augmentent de 0.089370 unit?.

#On remarque que la variable Assets transform?e est n?gativement li?e aux d?penses
#totales encourues transform?es. Or, cela entre en contradiction avec ce qui fut observ?
#dans la matrice de graphiques en nuage de points. Ceci est li? ? la multicolin?arit?
#entre Assets et Cash.

### Question 5 ###
x0 <- data.frame(Group=0,Mutual=1,Stock=0,StaffWage=85,LongLoss=0,ShortLoss=0.002,
                 GWPpersonal=0.006,GWPcommercial=0.006,Assets=0.131,Cash=0.127)
prediction <- predict(modele2,newdata=x0,type="response",interval="confidence")
#Il s'agit toutefois d'un intervalle de confiance pour ln(1+Y). J'obtiens l'intervalle
#souhait? en appliquant la transformation e^x-1 ? chacune des bornes.
IC <- exp(prediction[2:3])-1
names(IC) <- c("Borne inf?rieure","Borne sup?rieure")
IC
